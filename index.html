<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Wi-Fi Connection Check</title>
<style>
  body { font-family: Arial; padding: 20px; text-align: center; }
  #wifi-info, #success-info { display: none; margin-top: 30px; }
  button { padding: 12px 20px; font-size: 18px; cursor: pointer; margin: 5px; }
</style>
</head>
<body>

<h2>Wi-Fi Connection Check</h2>
<p id="status">Checking connection...</p>

<div id="wifi-info">
  <h3>Not connected to the correct network</h3>
  <p>Please connect to the Wi-Fi below:</p>
  <p><strong>SSID:</strong> MyNetwork</p>
  <p><strong>Password:</strong> mypassword</p>
  <div>
    <button onclick="openWifiSettings()">Open Wi-Fi Settings</button>
    <button onclick="checkConnection()">Check Again</button>
  </div>
</div>

<div id="success-info">
  <h3>Connected successfully ✔</h3>
  <p>You are on the correct network.</p>
  <div>
    <button onclick="goToWebsite()">Go to Portal</button>
    <button onclick="checkConnection()">Check Again</button>
  </div>
</div>

<script>
//const CHECK_URL = "http://192.168.4.1/ping";  // replace with your server
const CHECK_URL = "https://api.github.com";  // replace with your server
const TIMEOUT_MS = 5000;                       // 5s timeout
//const TARGET_URL = "https://example.com";      // target webpage when connected
const TARGET_URL = "http://192.168.4.1";      // target webpage when connected

async function checkConnection() {
  const statusEl = document.getElementById("status");
  statusEl.textContent = "Checking connection...";

  document.getElementById("wifi-info").style.display = "none";
  document.getElementById("success-info").style.display = "none";

  // Use AbortController to limit fetch to 5 seconds
  const controller = new AbortController();
  const timeout = setTimeout(() => controller.abort(), TIMEOUT_MS);

  try {
    const response = await fetch(CHECK_URL, {
      method: "GET",
      cache: "no-cache",
      signal: controller.signal
    });

    clearTimeout(timeout);

    if (response.ok) {
      showSuccessInfo();
    } else {
      showWifiInfo();
    }
  } catch (e) {
    clearTimeout(timeout);
    showWifiInfo();
  }
}

function showWifiInfo() {
  document.getElementById("status").textContent = "Not connected to the required network ✖";
  document.getElementById("wifi-info").style.display = "block";
}

function showSuccessInfo() {
  document.getElementById("status").textContent = "Connected to the correct network ✔";
  document.getElementById("success-info").style.display = "block";
}

function goToWebsite() {
  window.location.href = TARGET_URL;
}

function openWifiSettings() {
  const ua = navigator.userAgent || navigator.vendor || window.opera;

  if (/android/i.test(ua)) {
    try {
      window.location.href = "intent:#Intent;action=android.settings.WIFI_SETTINGS;end;";
    } catch (e) {
      alert("Cannot open Wi-Fi settings on this Android device.");
    }
  } else if (/iPad|iPhone|iPod/.test(ua) && !window.MSStream) {
    alert("iOS does not allow opening Wi-Fi settings from a webpage. Please open Settings → Wi-Fi manually.");
  } else {
    alert("Cannot open Wi-Fi settings automatically on this device. Please open Wi-Fi settings manually.");
  }
}

// Run the initial check on page load
checkConnection();
</script>

</body>
</html>

